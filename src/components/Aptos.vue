<template>
  <div>
    <h1> aptos</h1>
    <h2> address: {{address}}</h2>

    <div>
      <button @click="deploy">deploy</button>
    </div>
      <div>
          <button @click="deploy2">deploy2</button>
      </div>

    <div>
      <label >network</label>
      <select :value="network">
        <option value="Mainnet">Mainnet</option>
        <option value="Testnet">Testnet</option>
        <option value="Devnet">Devnet</option>
      </select>

      <button @click="switchNetwork">switchNetwork</button>
    </div>
  </div>
</template>

<script setup>
import { PetraWallet } from "petra-plugin-wallet-adapter";
import {WalletCore} from '@aptos-labs/wallet-adapter-core'
import {BCS, TxnBuilderTypes, HexString, AptosAccount,} from 'aptos'
import {onMounted,ref} from "vue";

import { Types, AptosClient } from 'aptos';


const arr = [ new PetraWallet()]
const wallet = new WalletCore(arr)
const address = ref('')
const network = ref('')

const packageMetadata= '076d6f6b736879610100000000000000004042433336343239383442453943463445424134354241304135413242393745423939363732364439434235443736384635314232323635394538453938434334b7011f8b08000000000002ff5d8ecd0e82301084ef7d8a864b2fd08247130f5e7c09424ca12b10ec4fbaa5c618dfdd36a226de7667be994cebe4b0c8113a62a4067aa04cdb05a7bb642482c7d99aac35bce63523ad54ca03226047362cb9c5b920ad0207468119e66c1e5db078f2a9f166fd9298071de7909ba6101cee8548efb4f67cb05ac80c5757d9e3760ed6034f002ba98798536ffdf229ac62c3776950896baf66ff23b48d20be98f88b31fa242f42d6c412f0000000020c6d65726b6c655f70726f6f668c081f8b08000000000002ffed575b6fdb36147ef7afd05220905601e64d57c701b6215806ac7b495e86a03028f2b016225b862e6d8a20ff7da46447176b495decf2d00ab02592df77cee1b911dce4b2cec0dae4f7e5fa338fe30d14f719ac76459eabc799a59fba04abac641c7f0451e5c5e27992efaabc5c354bede79a97ebc5ac5917f9b6acac9fffbcbdbaf9fdea8f5faf6fdffd76f3eea7db5faee3da67d6d2427bdcae4eb25458aade5a1fa148d567bbd1bcd775b17fd5e1e5a5abe7abb89b7033e0aa3776e224cfb3d664f36450692b36bbba0279ad0dd34a0d63f10ce0650945f583dd8a88e30cb61faab57d6ef438cb2525ee84f9ceeb7ca3e54bf8c6c0b475c561ead33ad5b1b053ebc21a4b6ddce23856b7c1838c66e52a830d6cabe58f075e921745fe69b5a92bfb5cffb528d74a7b06982755966dbcc40b58b554fb7ce036f77ca0406f0c8f8d30cf412ddfed602b5b95033103218b23fe28525d3ec5f13d08c1ef89e7db7d903310f134184156c29799d8b7ca1d88ff4a1307db1c9a3872bc1691bec5b389e5a1a2a5651272d6edd2d4ca28643c3eef1546d21f39711d0e8b22dd4a7898c83bbb5d384a3dee388fa39cb147696673b7213bd6a5355e4af64bce71440aa8ea626ba117fdf482b28baf50865f54b6774dfb7e8b1753e1c15d2cdedc555056ef9fc36246abb683daced0eba62be0a5653d9c49260150023c21d2a38a081152f0fc0007389124240858144621a68813e2139260045c520d8a502283e06c712498689b1fce3c857dc544a0308bb8602af230929150a150346488865a0a0b139a0829108eb0a7111230912a9238416442306d040b4f12e6231cfa2a20948a880410486dbe1001a202818750e27b54f09090802641a2b80c11f364e87116a009c1ac118c24f781322a7c0e58043ef622ca928087d843927a98705f2bf67d447d817c1e11eef949223967288a020ff704cfe796d2614bb71fac5c1776b586ae6e0e8acd04d68a0d706506761395e62421a3ce6c96c91196365836c26a0ccf1ad080d0a86b8eadbef0f9dcd8d6f4897276d4c78d796d4edf3556b5f4f78b63241922f1df23e910c91a249e42b221921e21e7f33514307104764737763b7734dec28e1b4593e76647226312715c8cd02b2c3a6651c3c2afb0d898c50ceb10a2b6c7f60bfbcd1d3cecb45340ae144fb3ba009beb7653ad442e413b0c473a4123d7ca72c1ab34dfeaa91bc894336a0b07eef7bef0bd2f7cf37dc1c4183c1d2981880f1ea3098150273e2448d752a4238925064f2a160441a8f42f509c27cc135261a280f2f04c576d5379a7b496ff502ffd9ff4b27f59efd3f8de36aa9af1158d0cee68ddf7e351591d72ccacdef5926bf28ed2e676fb26a7dc4a7ae7d2e234029920ec8b7bfa32d0dc2417ffc845e545234edee6c95677c3e16564f6f417c28365eb401000000000126d65726b6c655f6469737472696275746f72d60e1f8b08000000000002ffed596d4fe33810febebfc2cb49a89122d4a405da40d172c0dd56b7c00ad8d3ad56abc8891d8848935e5e801eea7f3f27b113db719222589d563abed0c4e3c78f67c6f3e22c229405182ca2fbe46e052d6b81e3fb00dbc84fd2d877b2348a9fdf01f29725182429b2acc4bf0d717c50bd84cb344aec62a8fc790793bb7a58065ec651e459d6f3350ebcb58ce2c570811fa3f8deb2dcc80f3b86f1030e530aa383b3fce9230c5180bb30a1eb46599876482c60086f31b255ab175b4c574b6cfba117a947a113e08ad54dfec4f129441c3791de3c609768f9e05df196683d735370cad4ef47e1294ea11f2480e815dce31528ed91ff5195128da61628610eb3c9915e09e4dbb073ca164428c649a2836a0c714bd8a53a793d1e9ec418a69827528c52f435cff62480fe829754707573191c2756a996434628db1b73849790a80559c089a24017e72a39ca0bb752bcc24994c52e9e13d329d8159285800518336130a6f36d172e8948e94896755d1c8613b8848e1ff8e94aa11bb51a0b0e288e963a118c62cc71e18e9e824c6dd2e6588b3f6c60b03e4ed47a8a35e1a2d0042076ec27599270a330211c2ee717375f3f9fd9e7f3ebf3e39b938f1681980d0f3891d3f9f5cdd5fcd72f37f3cb0bfbec2ff2745d0819bcd0fce2cfe34ff353fbf3d5e5e56fc5b0c90f1f075767c7a75fed934fc7f3f3b3d3a6009b7f3dfffde2ecaa181ff1e39f8fbf5cd379637a48979913f82e202a8b57c0cb42e0877e6af307eaf08468e08628e068209873bb8c9e7adbc94d304609ff4683eedf994f34a80c09b581029c820173525d70570dcc6a87750b77b4ab713ac0b324d6cf596807027835a3dc01099ad1224757805389473fbdcb25e8d1186c0ba45ad0a9bb10d412c56291cb8ebc1a819b0d9304c7e9fbc17bfc44b6901c2ad4743490e1355de15a1ce8227ac0761a1df251e388db80a4035d082fcf62ace09ff42ac82876c799405b2bc82877d6c149212f063cce09c560571fdfe217e5c8f9b4c6e591b65c527945881fcb77a432e8cc2ced9bd16a7e2acd34c259a75e1ad2a256ea4445b339e12f64ab81266a8be52c0f0609d69b581b28449dc65eae0fae7ab1ac18df12481c73766b073c00d27974a318e5c7d089e2387ab46f83c88181bdc8d20d4f58cd8a966a78416264f17bb04d60d8123b4ddfd1db72a668283957f61c29bd317903376fcce1ce8c30b6ae45e9d6d7ea5451ba444baea8d22ccb13729caeeab8b28c6689a2ce17473a4dc8c4533b7387ce872cbd59c189a985122b74a48ecd54a22dae239842d99ba4f02aeff50726a09ccd4e473ae2fcc64634d7cae47b8e81720fd4f86ac4e270294259076695fc68a822150b810e93c1b6b0d20e8b69ba60484d978a2305b28853863a309bd160478b23699701861ef1c87c7f6e429aa2c876562966a4d8e2f59cd27bf3f67189435446078aa14b08a5736b0aa2627bf98063df5b0d8a275d61cd1d3ef7d56dab65dd63d785f7e6eede8032d0345da830553a6a891eb3996ae52aeae88d0a98c3f63d30785fc6713f6196b75948c7a819344aad6a528aefcb08d5b1ade3fffa40a8e389fa631826de668944e7d9d058c46d8bfa29192ccddce2a6dd202d094581c5f289badd69a6932afe0a041a62ace729ff772516b05966596f983cf2888662f868930794f435196dc9a3ce0b4257fcfcb3476e761e45e1f2771eb3fa0a04a915d45e750efa162b21892e61e8620eb1abed69546d5ab7bb644b54347b24c8bdcc4384fe54d58c0ac5437f67fa46cef4e30c2c24fdbc105511dda4fa6d706ea0f2a987acc03d75dab248bd42ddf81687beb7f0fb292c47237f9bc95e5653d56055b903c8ad19eeb40ec1cb16ff9be73f324f518cf2f6291aad96cc5b5d494aaaac6ef6737bb3dff4c23ff27804ae9ca9e5588946c107dbd598c611fbe51b2963533b0a83d577c0bb52ce38c1a99d2ded5c42701ee63bac3aa92e11e9a715faac3db7f630ed6d1b6fc68357b77c6d5f5caafcceb4e41152f23ee5b6e0e5602dfd45e7571e525f93cb5b1f06fe3ff8f0bcd4e87914e2d5d140aca4cb21b16e73b6e80c504cd96a8c5efe21bd3386e2731e59e4e26f03ce55252f32565bb3076be187a984c3362b5b47df1dd67fac6710be2cf038e059f07a9e1d71a80fc3276818f96535355bf90e8d11c6430743c744bb23cf74ddc908efeeed1bfb8683cc8939c4e3e9643a314643689a7ba6e918430cd188084d870edadf67a762f681fed0be5721a1387b150bac8ed08d3b18209fb3575cabbccdad0a113066003c6dbd56595b0d5c93f078dadaf58c3d6fecee7bc6780addb137dd358668ea7a13d71b4dc6c3d184808c27cec871913b34a6c62e9140d83091374586333465dcea4a8aa0572ed47d0190efb1bffb6f9969f6cf64171546de85282f0072068a0966d704539aa0acf5e81d85e787a8accd0b1e7a01cecd6f4907cc4199a3f397068dcf50ade181aff07567abf9d57fabeb0b4de7172596007b8b86be65a5aeab7d2fc2da7aed61cdb2a15d374cab2256e95fdf0ad37cd755c0fc2550ddcf29b1cbbc94d75315900e7817ebaef1456adcb49ee2b3759e749bb0a17eab9673fd2f414911a83b22000000000300000000000000000000000000000000000000000000000000000000000000010e4170746f734672616d65776f726b00000000000000000000000000000000000000000000000000000000000000010b4170746f735374646c696200000000000000000000000000000000000000000000000000000000000000010a4d6f76655374646c696200'
const mvData1 = 'a11ceb0b060000000801000603061a04200205222c074e50089e014006de010e0cec01b5020000010101020003000100000402030000050405000206080701000107030300030102060a02060a020102020a020a02010a02030a0a020a020a02010101030002070a09000a0900030a02030a020c6d65726b6c655f70726f6f660a6170746f735f6861736806766563746f720e636f6d706172655f766563746f720966696e645f726f6f740676657269667906617070656e64096b656363616b3235360ff505af704efc4b90f0f5fd526c1d169e4852dcfe6efaf915d08b7285944e260000000000000000000000000000000000000000000000000000000000000001030800000000000000000a0201000000000006330600000000000000000c020a020a00410123042d05080a000a024201140a010a024201142404180b01010b00013100020a000a024201140a010a024201142304280b01010b00013101020b02060100000000000000160c0205020b01010b000131010201010000031d07010c020e000e01110031012104120d020b0038000d020b0138000b0211040c02051b0d020b0138000d020b0038000b0211040c020b020202010000093b0a020c030e014101062000000000000000210408050a0700270e02410106200000000000000021041005120700270600000000000000000c040a040e004103230437051a0d000a044303140c050e030e051100310121042c0d030b0538000b0311040c0305320d050b0338000b0511040c030b04060100000000000000160c0405140b030b01210200'
const mvData2 = 'a11ceb0b060000000b01001802182e0346900104d6012005f601b50107ab03d30508fe084006be09320af0093f0caf0afc030dab0e100000010101020103010401050106010701080109010a000b000c0800000d0600000e0600000f08000010000000110800081a040203010001051d04010601012706000934070000120001010000130102010000140301010000150401000016040100001705010000180401010007280702000129080900082a0b0c020300032b0d0e01000a2c11010100022d0e0e000b2e120c00042f020c010006300701010004311401010008321501020300053317010106093501180100093619020001371b1c000138071e01060839011f020304043a020f0100090a0a020a0f0b1001130e130f131013110a12161313161d170a1616121d181304060c050a0a020300010503060c0a020a0202060c0503060c050a0205070800050608030a020c01060c01060808010c02050302060b0602090009010900010101060900010a020103010202070a09000a0900030a0a020a020a0201090003060c050303070b0602090009010900090101080102070b0701090009000108090106080907080805060c0c0508080c02060c0a02020c0808010802010b07010900010b0602090009010107080001070803020608050c126d65726b6c655f6469737472696275746f72076163636f756e740a6170746f735f686173680362637304636f696e056576656e740c6d616e616765645f636f696e067369676e6572057461626c6509747970655f696e666f06766563746f720c6d65726b6c655f70726f6f6611436c61696d446973747269627574696f6e16436c61696d446973747269627574696f6e4576656e7417437265617465446973747269627574696f6e4576656e7413446973747269627574696f6e44657461696c730c4d6f6b736879614d6f6e65790c5265736f75726365496e666f12636c61696d5f646973747269627574696f6e0c636f696e5f6164647265737311696e69745f646973747269627574696f6e1270617573655f646973747269627574696f6e13726573756d655f646973747269627574696f6e0b7570646174655f726f6f740e77697468647261775f66756e647308636c61696d657273055461626c65067061757365640b636c61696d5f6576656e740b4576656e7448616e646c6507636c61696d657206616d6f756e7409636f696e5f747970650b6469737472696275746f720b6d65726b6c655f726f6f7412646973747269627574696f6e5f6576656e740b64756d6d795f6669656c6406736f757263650c7265736f757263655f636170105369676e65724361706162696c6974790a616464726573735f6f661d6372656174655f7369676e65725f776974685f6361706162696c69747908636f6e7461696e7308746f5f627974657306617070656e64096b656363616b323536067665726966791569735f6163636f756e745f72656769737465726564087265676973746572087472616e73666572036164640a656d69745f6576656e740854797065496e666f07747970655f6f660f6163636f756e745f61646472657373176372656174655f7265736f757263655f6163636f756e74106e65775f6576656e745f68616e646c65036e65770762616c616e63650ff505af704efc4b90f0f5fd526c1d169e4852dcfe6efaf915d08b7285944e2600000000000000000000000000000000000000000000000000000000000000010308020000000000000003080000000000000000030801000000000000000308030000000000000003080400000000000000000203190b060205031b011c0b070108010102031e051f03200502020321052005220a02030203220a022005230b070108020402012401050202250526080800010403000305066b0a0011070c050a012b05100011080c080a012b030c060b012a000c040a0410010a053800200415051d0b06010b00010b04010700270a0410021409210424052c0b06010b00010b04010704270e0538010c070d070e03380238030b020a061003140b07110c110d043c05440b06010b00010b040107002738040b0610041421044b05510b00010b04010701270a0538052004580b003806055a0b00010e080a050a0338070a040f010a050a0338080b040f050b050b0338041201380902010000001805380a0c000e0011140202010401031a3a0a000b0211150c080c060e0811080c090e0611070c070a07290320041005140b00010702270e090c050b080c030a0011070c040b050b040b0312052d050e090a0138040e09380b12032d030e09380c090e09380d12002d000e0938060b072a030f060b00110738040b011202380e0203010402000520130a012b051007140b001107210409050b0703270b012a000c02080b020f02150204010402000520130a012b051007140b001107210409050b0703270b012a000c02090b020f02150205010402030521130a012b051007140b001107210409050b0703270b012a030c030b020b030f0315020601040105221b0b012b050c020a02100011080c030b021007140a00110721040f05130b00010703270e030b0011070e031107380f3807020501000000010300030100020302050000'

onMounted(()=>{
  wallet.connect("Petra").then(() => {
    address.value = wallet.account.address
    console.log(wallet.network.name)
  })
})

const switchNetwork = () => {
  wallet.setNetwork(network.value)
}

const deploy = () => {
  console.log('deploy')
    const codeSerializer = new BCS.Serializer()
    const modules = [
        new TxnBuilderTypes.Module(
            new HexString(
                // eslint-disable-next-line max-len
               mvData2,
            ).toUint8Array(),
        ),
        new TxnBuilderTypes.Module(
            new HexString(
                // eslint-disable-next-line max-len
                mvData1,
            ).toUint8Array(),
        ),
    ]
    BCS.serializeVector(modules, codeSerializer)
    const payload = new TxnBuilderTypes.TransactionPayloadEntryFunction(
        TxnBuilderTypes.EntryFunction.natural(
            "0x1::code",
            "publish_package_txn",
            [],
            [BCS.bcsSerializeBytes(new HexString(packageMetadata).toUint8Array()), codeSerializer.getBytes()],
        ),
    );
    wallet.signAndSubmitTransaction(payload).then(async (tx) => {
        console.log('send:', tx)
        // NODE_URL 应该根据网络动态切换
    })
}

const deploy2 = async () => {
// Create an AptosClient to interact with devnet.
    //0x8bba16e5deef9100a5eab6d0de3b0ae541f08dccde30d8e795734ab4c87cb013
    const client = new AptosClient('https://fullnode.testnet.aptoslabs.com/v1');
    const aptosAccount = new AptosAccount(
        new HexString("0x8ba481423589138d4b83040f9dde205515c53247aac7e9fb8192d59067ac1939").toUint8Array()
    );
    try{
        const txnHash = await client.publishPackage(
            aptosAccount,
            new HexString(
                // package-metadata
                packageMetadata
            ).toUint8Array(),
            [
                new TxnBuilderTypes.Module(
                    new HexString(
                        // modules
                        mvData1
                    ).toUint8Array()
                ),
                new TxnBuilderTypes.Module(
                    new HexString(
                        // modules
                        mvData2
                    ).toUint8Array()
                ),
            ]
        );
        console.log(txnHash)
        await client.waitForTransaction(txnHash);
    }catch(error){
        console.log("publish error", error)
    }
}


</script>

<style scoped>

</style>
