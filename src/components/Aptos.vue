<template>
  <div>
    <h1> aptos</h1>
    <h2> address: {{address}}</h2>

    <div>
      <button @click="deploy">deploy</button>
    </div>
  </div>
</template>

<script setup>
import { PetraWallet } from "petra-plugin-wallet-adapter";
import {WalletCore} from '@aptos-labs/wallet-adapter-core'
import { BCS,TxnBuilderTypes,HexString} from 'aptos'
import {onMounted,ref} from "vue";

const arr = [ new PetraWallet()]
const wallet = new WalletCore(arr)
const address = ref('')

const packageMetadata= '0c6d795f746f646f5f6c6973740100000000000000004046434245344132363438323537303035393433383541373643434436414645354238433736353635463130434639323436334642343033353533363343353137ac011f8b08000000000002ff3d8e310e83300c45779f822d53035d2b3174e925104221712182c4511ca8b87d939676f393dfd7ff5d507a5113f6e095c3aaad843b86448686d57212b063644bbe3caeb2918d80ce60406fd06b8b2cef21113f62cebe282e3d4c3615774e29f0adae33cedb2835b95a15f3b2aa91cf53534499050111f74fb3b25e006fa3b1b1f05773b463fdfc359cd93fe73dca9888ccc83db8a3402b06016f0248f457d900000001046d61696ead091f8b08000000000002ffdd565b6fdb36147e6e7e05d702818d09699c745da7d4458bd5c08c65c900fb61585110b444d94224d123a93a5e91ffbea3c38b2e96bc141d86617971441e9ecb77beef90b988cb8c937ccfe2588661ced2827c3e3921a4549cb0ad168a2692e57c27e45d18b2281265a1af86f6f927dedd553a0e43cd56190fc3cf0b9e250159565f0fce0c0d54ba2eb86c2f699916eb305ce0ef5595d3b30f9a2b4d4591ed3f1e9aa2c9f3e76426a5900afe8f44a13499d19bdb259ddfcc97f377d7f3df67ef4352be7c41a6647255db2cdf2d7ea6ef6f678b9b259dfd365f2c9dd145d768bea03fdefef2ebf56c597bbac4d090451969b214b1b84ec17ec314b9e37b8093c09f66ea4e85a6f6d770ac8241ddbd097053714d2b038a0086c4fc84b3eae72756c470a4618d96d8082e3105587d686600fb185d692179406229b60114b16de642d318cf1a9755f7b982fcec3f6615ead6988fe9815bccb719d71c8eaf84c802177c5baeb23422602ff724290b1249ce34a7196031b2c409c9a9e9f4d824027e8806bcd00880f4d8996d8f9ae54fc177a37160b7ba98b910959559a39b06742e057fbe8de239ae22299144b9f8c489def03a2580459432e2a42c622e71cfd4e222e3d1ea1cd5c2450beaf2c6577f875495d1015241b70b6388f74799423a5db820ed35d7aa959a69a707db2c53bb0c889b0550b659a122f140792c98525cbab3482c93704c18a92a330c42a36f46fc1e56d46b97da9b513be4383814641dc9a77f807a2f5d5602a4bea3eb4cac5846f3520f87f521d20292cf014f2400b104f0eeed3738f781ce9a4c21df9ab981be0c0c0a6000cea1ecbc9f8a8418606ae4d824344acffa736cf4026ce7edb62d07ea4fafc184658a77c80b870d8c555a98455a68812b2828a3273b0a5059e5b6eadee81430ec14ae029faa2faa4653b98635c1040f6465d4e3d106b234a11e0077ea8c7c800489ceea4a1cf550e168658725cf536d746f056fb1c29abe802967edc1e22077b59bef6362b6bd19927373f8fe8b5a7ef2e4ffa6645b0cb2c2e4da4adf32bb520e3c6ad4e8f480d7b613552107f77f4f251828673ada005e6e01ced70555df924742c6d5fc30f16d6550d280ba5c16bd75a58a1442d77aef54e8e39d790b329d9a9910f43c58ea20e53686be9b20150d5a01061c13785e704f7cf3181bb1388727e394bc3dbf9f5c5c8e3ff649025f6d492676c6da0db9a3ecf7b3b52026c45bf34675b72d498444c7061277f9dbabd47e5330a298668f364ed1efb87935a43a6559fa27c7792b19bca576a9ded8049ad77cf36d63fde01bb0732d20bcab3db265d009ce09e32420eed55beae4d568f5f4c6de2b4f5d9a9e670684a99b7e766e8e4e5b4a3a50512f009d896723b55866a3c1a339202f9aa90c69f871913b91062e058cfa5d17807ea1f5c9bcd76d5f9596f2569136f0cb23967daafbfea83d5ee395f560a303f2ea88073fed7bc7bdc535203f34e868a4ae06b4debeae1c0d27ff748fbfbc6d9347776872fed81655030cec275fdda2c9c5d7f76872397ec4307df681df6f790405d084a55929f98801661a781c73303dbc837b47b01b88112b28dc28d490c2be51fecb43d97986c4f12ad462bdceea8bab10f87021bbfa2d7384d6170ef18793bf0042e3f74ef910000000000300000000000000000000000000000000000000000000000000000000000000010e4170746f734672616d65776f726b00000000000000000000000000000000000000000000000000000000000000010b4170746f735374646c696200000000000000000000000000000000000000000000000000000000000000010a4d6f76655374646c696200'
const mvData = 'a11ceb0b060000000c01000c020c1a03263c04620c056e6907d701fe0108d503400695041e10b3046a0a9d051e0cbb05c8010d8307080000010101020103010401050006070000070800040a0700051104020301000102130401060100080001000009020100000b0301000315020500051607080203000517090a0203000518010c0203040119020e0106051a1001020302021b11010106040605060606070d0806090d02060c030001060c02060c0802030507080007080101050203080002060b0302090009010900010102070b030209000901090001070901010801010b030209000901010800010b04010900040308000507080103070b0302090009010900090102070b040109000900046d61696e076163636f756e74056576656e74067369676e657206737472696e67057461626c65045461736b08546f646f4c6973740d636f6d706c6574655f7461736b0b6372656174655f6c69737406537472696e670b6372656174655f7461736b077461736b5f6964076164647265737307636f6e74656e7409636f6d706c65746564057461736b73055461626c650e7365745f7461736b5f6576656e740b4576656e7448616e646c650c7461736b5f636f756e7465720a616464726573735f6f6608636f6e7461696e730a626f72726f775f6d7574036e6577106e65775f6576656e745f68616e646c65067570736572740a656d69745f6576656e740ff505af704efc4b90f0f5fd526c1d169e4852dcfe6efaf915d08b7285944e260000000000000000000000000000000000000000000000000000000000000001030802000000000000000308030000000000000003080100000000000000126170746f733a3a6d657461646174615f76315603010000000000000011455f4e4f545f494e495449414c495a454400020000000000000012455441534b5f444f45534e545f455849535400030000000000000012455441534b5f49535f434f4d504c455445440000000002040c030d050e08020f01010203100b0302030800120b0401080014030001040101042b0b0011030c020a022901040705090702270b022a010c040a0410000a013800041205160b04010700270b040f000b0138010c030a031001140921042205260b0301070127080b030f011502010104000b0a38020a00380306000000000000000012010c010b000b012d010202010401010f270b0011030c040a042901040705090702270a042a010c050a05100214060100000000000000160c020a020a040b010912000c030a050f000a020a0338040b020b050f02150b042a010f030b03380502010000030102010100'

onMounted(()=>{
  wallet.connect("Petra").then(() => {
    address.value = wallet.account.address
  })

})

const deploy = () => {
  console.log('deploy')
  const codeSerializer = new BCS.Serializer()
  const modules =  [
        new TxnBuilderTypes.Module(
        new HexString(
        // eslint-disable-next-line max-len
        mvData,
        ).toUint8Array(),
        ),
      ]
  BCS.serializeVector(modules, codeSerializer)
  const payload = new TxnBuilderTypes.TransactionPayloadEntryFunction(
      TxnBuilderTypes.EntryFunction.natural(
          "0x1::code",
          "publish_package_txn",
          [],
          [BCS.bcsSerializeBytes(new HexString(packageMetadata).toUint8Array()), codeSerializer.getBytes()],
      ),
  );
  wallet.signAndSubmitTransaction(payload).then((tx)=> {
    console.log('send:',tx)
  })
}

</script>

<style scoped>

</style>
