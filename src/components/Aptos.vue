<template>
  <div>
    <h1> aptos</h1>
    <h2> address: {{address}}</h2>

    <div>
      <button @click="deploy">deploy</button>
    </div>

    <div>
      <label >network</label>
      <select :value="network">
        <option value="Mainnet">Mainnet</option>
        <option value="Testnet">Testnet</option>
        <option value="Devnet">Devnet</option>
      </select>

      <button @click="switchNetwork">switchNetwork</button>
    </div>
  </div>
</template>

<script setup>
import { PetraWallet } from "petra-plugin-wallet-adapter";
import {WalletCore} from '@aptos-labs/wallet-adapter-core'
import { BCS,TxnBuilderTypes,HexString,} from 'aptos'
import {onMounted,ref} from "vue";

const arr = [ new PetraWallet()]
const wallet = new WalletCore(arr)
const address = ref('')
const network = ref('')

const packageMetadata= '0c6d795f746f646f5f6c6973740100000000000000004034413445433036453734373235383034364245364338303234393541333542373735413945454336343236423532383538414246353543373432413346443536f5011f8b08000000000002ffb590bf6ec3201087779e02796149c0ee58294397be40bb5911c2e69a20db6071c46d55f5ddc3397f9521ca920deebedfdda7ab47d37666036be6cd007cc5c5f0ab53b041f70e9360134474c153a392a52c0563b5b1360222e09a1149a0a6da4a68c13e92cd7051fe540533630aa8f1aac26a0b23780bbe75947f23e23de6d5df217619fbe31b9768db36a5115f95cadfedae916d18d43c6ed99b068fcf36449019100b1e61a2d4a1fe751ab89c2af992a517b86bac8b17620813a833a66e6282ff1fcc3e43077eb67a8e163f7b1577bc12591427a77ce0de35cf3bd5634e385b64a93dfa47fcd4410200000108746f646f6c697374ad091f8b08000000000002ffdd565b6fdb36147e6e7e05d702818d09699c745d27d7458bd5c08c65c900fb61585110b444db4264d123a93a5991ffbec3c38b2e96bc141d066c7971441e9ecb77beef905b919639275aa422cf94a62c4d651cfb4ff2f9e484905271c2765a28ba926ccbf742dec6314b1251167aecf6954ee35865eb82cb71df11fe89b70f689915eb389ee36ff3201a68b6cc791c7f9ef37c159185f97a3066cf3e680ed98a22bfff78e8706cb27efe9c4ca51452c1ff8928a09829bdbe59d0d9f56c317b7735fb7dfa3e26e5cb17644246e3ca66f16efe337d7f339d5f2fe8f4b7d97ce18d2eda46b339fdf1e6975fafa68bcad32586862cca449305a0786550dc30456ef93da049e04f3375ab625bcc6b3866ea52b76f22dc545c53634011ac98d89f786a7e7e62450a476ad668897de0125380d5877a06b08fd195169247249562174111bb7a2e344bf1ac756908c0958addaf5d84b235a6631be517b7bb9c6b0ea79742e4918fbd2b97799610b097f764551624919c694e0da1068e363139b56419da3cc00f72108d00c7009ddd0ea0393e147c3f18466eab0d990f61acec1addd490f32984f34d10cf711549861cda8a4f208f0daf5202584429134eca22e512f76c2d3e321e35e7a8163e5a5495371cff1d5226a303a4a276178610ef8f328374da7041da6bae552335dbce00b65da66e1910b70bb1ef3b15ab0054c08229c5a53f8bbcb209a78411539925101a7d33e077b0a25efbd4de0c9a2187d1a11eab4821fd03d43be9b214a0f43d5de762c972ba2d757fd810222b20f92de08904208e00c1bdfb06e721d0599d29e45b3b36d0978541010cc039545df06348880126568d7542a3f29c3fcf46afbf5687fcb6e340f51934b862b9e22df2c2610ba3490bb3c80a2d70050565f5e426012aabdc99ee0d4e01c356e12a0aa986a22a34956f581d4cf04096563d016d204b1dea1e7027de28045821d1595589a71e2a1caddcace4db4c5bdd3bc13bacb0a62f60ca5973b078c87dedf6fb98985d6ffae45c9fbdffa2969f3cf9bf29d91583acb0b936d277cc36ca6159a106a707bc769d30851c5cff1d9560a02dd3c906f0f20b70be2ac87c4b9e08999af961e3bbcaa0a41e75f92c3aebca142984aef4deaa30c43b0b166432b13321ea78af5441ca5d0a7db7410c0d1a017a1c13785df0407cfb161bb0749b15b0f7f6fc6e747139fcd825097cb4ad72b1b7d67ec81d657f98ad05b121de361eabfed2252b21d1bf45c6bf01dc8deabe291851ccb64322a7e87e58bf21329db13cfb93e3d8950c5e54fb4c6f5c1ef5dbbefec4717ef025d8ba1d10e5e53d92a6d7098e0beb2422fe855cead5abc1f2e9b5bb5e9efa3403dd2c08133f04ddf81c9c36047520a64e005a83cf456a90cd4583a773445ed453e993f2e322b722f5dc0d18f5bb3600dd7aeb527ba7dbae2a1df39d305de097472cbbc4f7fd517bbccd8d756fa323f2ea888730f43ba7bec335223fd4e86815af7a24dfbcb53c0d47ff748fbfbc6da347776874fed816993906f6a3af6ed1e8e2eb7b34ba1c3e62a63efbc0ef763c8102e88a657929f98001661a789c72303dbc8a3b27b11f88092b285c2cd492c23d55fe03b3d97b86fcf162d462bdceab6bac10f88c21fbea657384dd171ef88793bf0098abd95e1011000000000400000000000000000000000000000000000000000000000000000000000000010e4170746f734672616d65776f726b00000000000000000000000000000000000000000000000000000000000000010b4170746f735374646c696200000000000000000000000000000000000000000000000000000000000000010a4d6f76655374646c696200000000000000000000000000000000000000000000000000000000000000030a4170746f73546f6b656e00'
const mvData = 'a11ceb0b060000000c01000c020c1a03263c04620c056e6907d701820208d903400699041e10b7046a0aa1051e0cbf05c8010d8707080000010101020103010401050006070000070800040a0700051104020301000102130401060100080001000009020100000b0301000315020500051607080203000517090a0203000518010c0203040119020e0106051a1001020302021b11010106040605060606070d0806090d02060c030001060c02060c0802030507080007080101050203080002060b0302090009010900010102070b030209000901090001070901010801010b030209000901010800010b04010900040308000507080103070b0302090009010900090102070b04010900090008746f646f6c697374076163636f756e74056576656e74067369676e657206737472696e67057461626c65045461736b08546f646f4c6973740d636f6d706c6574655f7461736b0b6372656174655f6c69737406537472696e670b6372656174655f7461736b077461736b5f6964076164647265737307636f6e74656e7409636f6d706c65746564057461736b73055461626c650e7365745f7461736b5f6576656e740b4576656e7448616e646c650c7461736b5f636f756e7465720a616464726573735f6f6608636f6e7461696e730a626f72726f775f6d7574036e6577106e65775f6576656e745f68616e646c65067570736572740a656d69745f6576656e740ff505af704efc4b90f0f5fd526c1d169e4852dcfe6efaf915d08b7285944e260000000000000000000000000000000000000000000000000000000000000001030802000000000000000308030000000000000003080100000000000000126170746f733a3a6d657461646174615f76315603010000000000000011455f4e4f545f494e495449414c495a454400020000000000000012455441534b5f444f45534e545f455849535400030000000000000012455441534b5f49535f434f4d504c455445440000000002040c030d050e08020f01010203100b0302030800120b0401080014030001040101042b0b0011030c020a022901040705090702270b022a010c040a0410000a013800041205160b04010700270b040f000b0138010c030a031001140921042205260b0301070127080b030f011502010104000b0a38020a00380306000000000000000012010c010b000b012d010202010401010f270b0011030c040a042901040705090702270a042a010c050a05100214060100000000000000160c020a020a040b010912000c030a050f000a020a0338040b020b050f02150b042a010f030b03380502010000030102010100'

const scriptMetadata = '064d696e7465720100000000000000004035323439323032334345444143414439423636454531444442393332463930423537394630304330323745343542443535384634363541354643434341464546ab011f8b08000000000002ff5d8cbb0ec2300c45f77c45d4254b9b144624061636bea0ea90a6a68d4a1e72d23020fe9d44bca4ca83edab736ee7a55ae4043db1d2003dd2eaa26d04ac48020cdad912b53c4f45483782073b82551a424f4e3eba70c6ecdd1d2e197cd049c7bcd91ca30f0721f23baf0357ce0859e0e62687f0399543e01960354548c57ae7d76f6193767ccf5b5687751835fe09e312881f26361aa34ff202191db2f3d6000000000300000000000000000000000000000000000000000000000000000000000000010e4170746f734672616d65776f726b00000000000000000000000000000000000000000000000000000000000000010b4170746f735374646c696200000000000000000000000000000000000000000000000000000000000000010a4d6f76655374646c696200'
const scriptMvData = 'a11ceb0b0600000008010008020804030c150421020523100733500883012006a30114000000010002000301050800030403010002060105010001070002000008000200010403060c050301050001060c01080001030d6170746f735f6163636f756e740a6170746f735f636f696e04636f696e067369676e65720a616464726573735f6f66094170746f73436f696e0762616c616e6365046d696e74087472616e7366657200000000000000000000000000000000000000000000000000000000000000010308a0860100000000000308ffffffffffffffff000001170a0011000c030a03380007010a02170700172304120a000b030a0207001611020b000b010b02110302'

onMounted(()=>{
  wallet.connect("Petra").then(() => {
    address.value = wallet.account.address
    console.log(wallet.network.name)
  })
})

const switchNetwork = () => {
  wallet.setNetwork(network.value)
}

const deploy = () => {
  console.log('deploy')
  const codeSerializer = new BCS.Serializer()
  // const modules =  [
  //       new TxnBuilderTypes.Module(
  //       new HexString(
  //       // eslint-disable-next-line max-len
  //       scriptMvData,
  //       ).toUint8Array(),
  //       ),
  //     ]
  // address = AccountAddress.fromHex("0x0ff505af704efc4b90f0f5fd526c1d169e4852dcfe6efaf915d08b7285944e26")
  const modules =  [
    new TxnBuilderTypes.Script(new HexString(
            // eslint-disable-next-line max-len
            scriptMvData,
        ).toUint8Array(),
        [],[],
    ),
  ]
  BCS.serializeVector(modules, codeSerializer)
  const payload = new TxnBuilderTypes.TransactionPayloadEntryFunction(
      TxnBuilderTypes.EntryFunction.natural(
          "0x1::code",
          "publish_package_txn",
          [],
          [BCS.bcsSerializeBytes(new HexString(scriptMetadata).toUint8Array()), codeSerializer.getBytes()],
      ),
  );
  wallet.signAndSubmitTransaction(payload).then((tx)=> {
    console.log('send:',tx)
  })
}

</script>

<style scoped>

</style>
